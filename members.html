<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Birdie Bush Bandits â€“ Members</title>
  <meta name="description" content="Meet the members of Birdie Bush Bandits golf group, view their handicaps and latest scores.">
  <link rel="icon" type="image/svg+xml" href="bbb-logo.svg">
  <!-- Add Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">
  <!-- Global CSS -->
  <link rel="stylesheet" href="css/style.css">
  <!-- Additional styles for the premium members display -->
  <style>
    /* Premium Member Display Styles */
    .search-container {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .search-icon {
      position: absolute;
      right: 12px;
      top: 12px;
      color: var(--bbb-text-muted);
    }

    .premium-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: space-between;
      margin-bottom: 2rem;
      background-color: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: var(--shadow-sm);
    }

    .view-toggle {
      display: flex;
      border: 1px solid var(--bbb-border);
      border-radius: 4px;
      overflow: hidden;
    }

    .view-toggle button {
      background-color: white;
      border: none;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
    }

    .view-toggle button.active {
      background-color: var(--bbb-primary);
      color: white;
    }

    /* Premium Member Cards */
    .members-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    .premium-member-card {
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--bbb-border);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .premium-member-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .card-header-premium {
      position: relative;
      background-color: var(--bbb-primary);
      padding: 2rem 1rem 1.5rem;
      text-align: center;
    }

    .golf-pattern {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.1;
    }

    .profile-image-container {
      position: relative;
      z-index: 1;
      display: inline-block;
    }

    .profile-image {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: var(--shadow-md);
      object-fit: cover;
      background-color: #f0f0f0;
    }

    .card-body-premium {
      padding: 1.5rem;
      text-align: center;
    }

    .member-name {
      font-size: 1.25rem;
      font-weight: bold;
      margin: 0 0 0.25rem;
    }

    .member-nickname {
      font-style: italic;
      color: var(--bbb-text-muted);
      margin-bottom: 1rem;
    }

    .handicap-badge {
      display: inline-block;
      background-color: var(--bbb-primary);
      color: white;
      font-weight: bold;
      padding: 0.25rem 1rem;
      border-radius: 9999px;
      margin-bottom: 1rem;
    }

    .member-bio {
      color: var(--bbb-text-light);
      margin-bottom: 1.25rem;
      /* Line clamp for 3 lines */
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .stat-box {
      background-color: #f8f9fa;
      padding: 0.75rem;
      border-radius: 4px;
      text-align: center;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--bbb-text-muted);
    }

    .stat-value {
      font-weight: bold;
      color: var(--bbb-text);
    }

    .card-footer-premium {
      background-color: #f8f9fa;
      padding: 1rem;
      border-top: 1px solid var(--bbb-border);
    }

    /* List View */
    .premium-member-list-item {
      display: flex;
      flex-wrap: wrap;
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--bbb-border);
      box-shadow: var(--shadow-md);
      margin-bottom: 1rem;
    }

    .list-item-left {
      flex: 0 0 250px;
      background-color: var(--bbb-primary);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
    }

    .list-item-right {
      flex: 1;
      padding: 1.5rem;
    }

    .achievement-tag {
      display: inline-block;
      background-color: #e6f7ff;
      color: #0066cc;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }

    /* Modal styles */
    .member-modal {
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.75);
      z-index: 1000;
      overflow-y: auto;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-container {
      background-color: white;
      border-radius: 8px;
      width: 100%;
      max-width: 800px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .modal-header {
      background-color: var(--bbb-primary);
      color: white;
      padding: 1.5rem;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      color: white;
      background: none;
      border: none;
      cursor: pointer;
    }

    .modal-profile {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .modal-tabs {
      display: flex;
      border-bottom: 1px solid var(--bbb-border);
      padding: 0 1.5rem;
    }

    .modal-tab {
      padding: 1rem;
      border-bottom: 2px solid transparent;
      margin-right: 1rem;
      cursor: pointer;
    }

    .modal-tab.active {
      border-bottom-color: var(--bbb-primary);
      color: var(--bbb-primary);
      font-weight: bold;
    }

    .modal-content {
      padding: 1.5rem;
      overflow-y: auto;
      flex-grow: 1;
    }

    .modal-content-section {
      display: none;
    }

    .modal-content-section.active {
      display: block;
    }

    .modal-footer {
      background-color: #f8f9fa;
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--bbb-border);
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }

    /* Progress Bar */
    .progress-container {
      width: 100%;
      background-color: #e9ecef;
      border-radius: 999px;
      height: 10px;
      margin-bottom: 1rem;
    }

    .progress-bar {
      height: 100%;
      border-radius: 999px;
      background-color: var(--bbb-primary);
    }

    .stats-card {
      background-color: white;
      border: 1px solid var(--bbb-border);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .big-stat {
      background-color: #f8f9fa;
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
    }

    .big-stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: var(--bbb-primary);
    }

    .big-stat-label {
      font-size: 0.75rem;
      color: var(--bbb-text-muted);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .premium-controls {
        flex-direction: column;
      }
      
      .list-item-left {
        flex: 0 0 100%;
      }
      
      .stat-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  
  <!-- Core Modules -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/db.js"></script>
  <script src="js/ui.js"></script>
</head>
<body>
  <!-- Authentication Protection -->
  <script>
    // Check if BBB_AUTH is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for auth module to initialize
      setTimeout(function() {
        if (typeof BBB_AUTH !== 'undefined') {
          // If not authenticated and not on login page, redirect to login
          if (!BBB_AUTH.isAuthenticated && window.location.pathname.indexOf('login.html') === -1) {
            // Save the current URL to redirect back after login
            sessionStorage.setItem('redirectAfterLogin', window.location.pathname);
            window.location.href = 'login.html';
          }
        } else {
          console.error('BBB_AUTH module not found! Authentication check failed.');
        }
      }, 100); // Small delay to ensure modules are loaded
    });
  </script>
  
  <!-- Rest of your page content -->
  <a href="#main" class="skip-link">Skip to main content</a>
  
  <main id="main"></main>
  
  <!-- Member Detail Modal (initially hidden) -->
  <div id="member-modal" class="member-modal">
    <div class="modal-container">
      <div class="modal-header">
        <button id="modal-close" class="modal-close">
          <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
        <div class="modal-profile">
          <div>
            <img id="modal-profile-image" class="profile-image" src="" alt="Member profile">
          </div>
          <div>
            <h2 id="modal-name" class="text-xl font-bold"></h2>
            <p id="modal-nickname" class="text-green-100 italic"></p>
            <div class="mt-2">
              <span id="modal-handicap" class="inline-block bg-white text-green-800 px-3 py-1 rounded-full text-sm font-bold"></span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-tabs">
        <div class="modal-tab active" data-tab="about">About</div>
        <div class="modal-tab" data-tab="stats">Stats</div>
        <div class="modal-tab" data-tab="scores">Recent Scores</div>
        <div class="modal-tab" data-tab="achievements">Achievements</div>
      </div>
      
      <div class="modal-content">
        <!-- About Tab -->
        <div id="about-section" class="modal-content-section active">
          <h3 class="text-xl font-bold text-gray-800 mb-4">About <span id="about-name"></span></h3>
          <p id="about-bio" class="mb-6"></p>
          <p id="about-detail"></p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
            <div class="stats-card">
              <h4 class="font-bold text-gray-700 mb-3">Golf Preferences</h4>
              <ul id="member-preferences" class="space-y-2">
                <!-- Populated dynamically -->
              </ul>
            </div>
            <div class="stats-card">
              <h4 class="font-bold text-gray-700 mb-3">Contact Information</h4>
              <p class="text-gray-600">Contact information is only visible to other members. Please log in to view contact details.</p>
              <button class="btn btn-sm mt-2">Send Message</button>
            </div>
          </div>
        </div>
        
        <!-- Stats Tab -->
        <div id="stats-section" class="modal-content-section">
          <h3 class="text-xl font-bold text-gray-800 mb-6">Performance Stats</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="stats-card">
              <div class="flex justify-between mb-1">
                <span class="text-sm font-medium text-gray-700">Driving Accuracy</span>
                <span id="driving-accuracy" class="text-sm font-medium text-gray-700">-</span>
              </div>
              <div class="progress-container">
                <div id="driving-accuracy-bar" class="progress-bar" style="width: 0%"></div>
              </div>
              
              <div class="flex justify-between mb-1 mt-4">
                <span class="text-sm font-medium text-gray-700">Greens in Regulation</span>
                <span id="gir" class="text-sm font-medium text-gray-700">-</span>
              </div>
              <div class="progress-container">
                <div id="gir-bar" class="progress-bar bg-blue-500" style="width: 0%"></div>
              </div>
              
              <div class="flex justify-between mb-1 mt-4">
                <span class="text-sm font-medium text-gray-700">Putting Average</span>
                <span id="putting-avg" class="text-sm font-medium text-gray-700">-</span>
              </div>
              <div class="progress-container">
                <div id="putting-avg-bar" class="progress-bar bg-purple-500" style="width: 0%"></div>
              </div>
              
              <div class="flex justify-between mb-1 mt-4">
                <span class="text-sm font-medium text-gray-700">Scoring Average</span>
                <span id="scoring-avg" class="text-sm font-medium text-gray-700">-</span>
              </div>
              <div class="progress-container">
                <div id="scoring-avg-bar" class="progress-bar bg-yellow-500" style="width: 0%"></div>
              </div>
            </div>
            
            <div class="stats-card">
              <h4 class="font-bold text-gray-700 mb-3">Performance Highlights</h4>
              <div class="stat-grid">
                <div class="big-stat">
                  <div id="avg-score-value" class="big-stat-value">-</div>
                  <div class="big-stat-label">Average Score</div>
                </div>
                <div class="big-stat">
                  <div id="handicap-value" class="big-stat-value">-</div>
                  <div class="big-stat-label">Handicap Index</div>
                </div>
                <div class="big-stat">
                  <div id="gir-value" class="big-stat-value">-</div>
                  <div class="big-stat-label">GIR</div>
                </div>
                <div class="big-stat">
                  <div id="putting-value" class="big-stat-value">-</div>
                  <div class="big-stat-label">Putting Avg</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Scores Tab -->
        <div id="scores-section" class="modal-content-section">
          <h3 class="text-xl font-bold text-gray-800 mb-6">Recent Scores</h3>
          
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-200">
              <thead>
                <tr>
                  <th class="py-3 px-4 border-b text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                  <th class="py-3 px-4 border-b text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
                  <th class="py-3 px-4 border-b text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tees</th>
                  <th class="py-3 px-4 border-b text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gross Score</th>
                  <th class="py-3 px-4 border-b text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stableford</th>
                </tr>
              </thead>
              <tbody id="scores-table-body">
                <!-- Populated dynamically -->
              </tbody>
            </table>
          </div>
          
          <div class="mt-6 text-right">
            <button class="btn btn-sm">View All Scores</button>
          </div>
        </div>
        
        <!-- Achievements Tab -->
        <div id="achievements-section" class="modal-content-section">
          <h3 class="text-xl font-bold text-gray-800 mb-6">Achievements</h3>
          
          <div id="achievements-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Populated dynamically -->
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="modal-close-btn" class="btn btn-sm" style="background-color: #6c757d;">Close</button>
        <button class="btn btn-sm">Contact Member</button>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize modules
      BBB_AUTH.init({
        cloudflareEnabled: BBB_CONFIG.cloudflareEnabled
      });
      
      BBB_DB.init({
        useCloudflare: BBB_CONFIG.cloudflareEnabled,
        localStoragePrefix: 'bbb_'
      });
      
      // Create header
      const headerElements = BBB_UI.createHeader({
        fixed: true,
        showHomeLinkText: true
      });
      
      document.body.insertBefore(headerElements.header, document.body.firstChild);
      
      // Get main content element
      const main = document.getElementById('main');
      main.appendChild(headerElements.mainWrapper);
      
      // Create page content
      const mainContent = document.createElement('div');
      
      // Create page title
      const titleContainer = BBB_UI.createPageTitle({
        title: 'Birdie Bush Bandits',
        showFoundedText: true,
        showGolfballs: true
      });
      mainContent.appendChild(titleContainer);
      
      // Add page subtitle with enhanced styling
      const subtitle = document.createElement('h2');
      subtitle.textContent = 'Members Directory';
      subtitle.className = 'text-center font-montserrat text-2xl font-bold text-gray-700 mb-6';
      mainContent.appendChild(subtitle);
      
      // Create status message container
      const statusMessage = BBB_UI.createStatusMessage();
      mainContent.appendChild(statusMessage);
      
      // Intro text with improved styling
      const introText = document.createElement('p');
      introText.className = 'intro-text text-center max-w-3xl mx-auto mb-8 text-gray-600 leading-relaxed';
      introText.textContent = 'Meet our dedicated golfers who make up the Birdie Bush Bandits. From beginners to seasoned players, our diverse group enjoys friendly competition and camaraderie on the course. Each member brings unique skills and enthusiasm to our golf community.';
      mainContent.appendChild(introText);
      
      // Create premium controls
      const controlsContainer = document.createElement('div');
      controlsContainer.className = 'premium-controls';
      
      // Search bar
      const searchContainer = document.createElement('div');
      searchContainer.className = 'search-container';
      
      const searchInput = document.createElement('input');
      searchInput.type = 'text';
      searchInput.placeholder = 'Search members...';
      searchInput.className = 'w-full px-4 py-3 border border-gray-300 rounded-lg';
      searchContainer.appendChild(searchInput);
      
      const searchIcon = document.createElement('div');
      searchIcon.className = 'search-icon';
      searchIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>`;
      searchContainer.appendChild(searchIcon);
      
      controlsContainer.appendChild(searchContainer);
      
      // Sort and view options
      const optionsContainer = document.createElement('div');
      optionsContainer.className = 'flex gap-2';
      
      // Sort dropdown
      const sortSelect = document.createElement('select');
      sortSelect.className = 'px-3 py-2 border border-gray-300 rounded-lg';
      
      const sortOptions = [
        { value: 'name', text: 'Sort by Name' },
        { value: 'handicap', text: 'Sort by Handicap' },
        { value: 'joined', text: 'Sort by Newest' }
      ];
      
      sortOptions.forEach(option => {
        const optionElement = document.createElement('option');
        optionElement.value = option.value;
        optionElement.textContent = option.text;
        sortSelect.appendChild(optionElement);
      });
      
      optionsContainer.appendChild(sortSelect);
      
      // View toggle
      const viewToggle = document.createElement('div');
      viewToggle.className = 'view-toggle';
      
      const gridButton = document.createElement('button');
      gridButton.className = 'active';
      gridButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
      </svg>`;
      
      const listButton = document.createElement('button');
      listButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>`;
      
      viewToggle.appendChild(gridButton);
      viewToggle.appendChild(listButton);
      
      optionsContainer.appendChild(viewToggle);
      controlsContainer.appendChild(optionsContainer);
      
      mainContent.appendChild(controlsContainer);
      
      // Container for members list
      const membersContainer = document.createElement('div');
      membersContainer.className = 'members-grid';
      membersContainer.id = 'members-container';
      mainContent.appendChild(membersContainer);
      
      // Append no results message (initially hidden)
      const noResults = document.createElement('div');
      noResults.className = 'text-center py-16 bg-white rounded-lg shadow hidden';
      noResults.id = 'no-results';
      noResults.innerHTML = `
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No members found</h3>
        <p class="mt-1 text-sm text-gray-500">Try adjusting your search or filter criteria.</p>
      `;
      mainContent.appendChild(noResults);
      
      // Add content to main wrapper
      headerElements.mainWrapper.appendChild(mainContent);
      
      // Enhanced member data with additional fields
      const enhancedMemberData = {};
      
      // Load handicap data for all members
      const handicapPromises = BBB_CONFIG.members.map(member => 
        BBB_DB.getMemberHandicap(member.toLowerCase())
          .then(data => {
            // Create enhanced member data with default values
            enhancedMemberData[member] = {
              name: member,
              nickname: generateNickname(member),
              handicap: data ? data.index : null,
              joined: data ? data.calculatedAt : new Date().toISOString(),
              bio: generateBio(member),
              about: generateAbout(member),
              profileImage: 'https://via.placeholder.com/150',
              favoriteClub: getRandomFavoriteClub(),
              favoriteCourse: getRandomCourse(),
              achievements: generateAchievements(),
              stats: generateStats(data ? data.index : 15)
            };
            
            return { member, handicap: data };
          })
          .catch(() => {
            // Default values if handicap data isn't available
            enhancedMemberData[member] = {
              name: member,
              nickname: generateNickname(member),
              handicap: null,
              joined: new Date().toISOString(),
              bio: generateBio(member),
              about: generateAbout(member),
              profileImage: 'https://via.placeholder.com/150',
              favoriteClub: getRandomFavoriteClub(),
              favoriteCourse: getRandomCourse(),
              achievements: generateAchievements(),
              stats: generateStats(15)
            };
            
            return { member, handicap: null };
          })
      );
      
      // Load scorecards to calculate recent scores
      BBB_DB.getScorecards()
        .then(scorecards => {
          const scorecardsArray = Object.values(scorecards);
          
          // Process all handicap data
          Promise.all(handicapPromises)
            .then(memberData => {
              // Create premium member cards
              memberData.forEach(data => {
                // Find recent scores for this member
                const recentScores = findRecentScores(scorecardsArray, data.member);
                enhancedMemberData[data.member].recentScores = recentScores;
                
                // Create member card
                const memberCard = createPremiumMemberCard(data.member, data.handicap, recentScores, enhancedMemberData[data.member]);
                membersContainer.appendChild(memberCard);
              });
              
              // Setup event listeners for view toggle
              gridButton.addEventListener('click', function() {
                gridButton.classList.add('active');
                listButton.classList.remove('active');
                membersContainer.className = 'members-grid';
                refreshMembersList();
              });
              
              listButton.addEventListener('click', function() {
                listButton.classList.add('active');
                gridButton.classList.remove('active');
                membersContainer.className = 'space-y-4';
                refreshMembersList();
              });
              
              // Setup search functionality
              searchInput.addEventListener('input', function() {
                const searchText = this.value.toLowerCase();
                refreshMembersList(searchText);
              });
              
              // Setup sort functionality
              sortSelect.addEventListener('change', function() {
                refreshMembersList(searchInput.value.toLowerCase());
              });
              
              // Setup modal functionality
              setupModalInteraction();
            })
            .catch(err => {
              console.error('Error loading member data:', err);
              BBB_UTILS.showMessage('Error loading member data', 'error');
            });
        })
        .catch(err => {
          console.error('Error loading scorecards:', err);
          BBB_UTILS.showMessage('Error loading scorecards', 'error');
        });
      
      /**
       * Find recent scores for a member
       * @param {Array} scorecards - Array of scorecards
       * @param {string} memberName - Member name to find scores for
       * @returns {Array} - Array of recent scores
       */
      function findRecentScores(scorecards, memberName) {
        // Filter scorecards that include this member
        const memberScores = [];
        
        scorecards.forEach(scorecard => {
          if (scorecard.players && Array.isArray(scorecard.players)) {
            const playerData = scorecard.players.find(player => 
              player.name === memberName
            );
            
            if (playerData) {
              memberScores.push({
                date: new Date(scorecard.date || scorecard.createdAt),
                course: scorecard.course,
                tee: scorecard.tee,
                totalShots: playerData.totalShots || 0,
                stablefordPoints: playerData.totalPoints || 0
              });
            }
          }
        });
        
        // Sort by date descending
        memberScores.sort((a, b) => b.date - a.date);
        
        // Return 3 most recent
        return memberScores.slice(0, 3);
      }
      
      /**
       * Create a premium member card
       * @param {string} memberName - Member name
       * @param {Object} handicapData - Handicap data
       * @param {Array} recentScores - Recent scores
       * @param {Object} enhancedData - Enhanced member data
       * @returns {HTMLElement} - Member card element
       */
      function createPremiumMemberCard(memberName, handicapData, recentScores, enhancedData) {
        const currentView = gridButton.classList.contains('active') ? 'grid' : 'list';
        
        if (currentView === 'grid') {
          return createGridCard(memberName, handicapData, recentScores, enhancedData);
        } else {
          return createListCard(memberName, handicapData, recentScores, enhancedData);
        }
      }
      
      /**
       * Create a grid card for premium member display
       */
      function createGridCard(memberName, handicapData, recentScores, enhancedData) {
        const card = document.createElement('div');
        card.className = 'premium-member-card';
        card.dataset.member = memberName;
        
        // Member header with background pattern
        const header = document.createElement('div');
        header.className = 'card-header-premium';
        
        // Golf ball pattern background
        const pattern = document.createElement('div');
        pattern.className = 'golf-pattern';
        pattern.innerHTML = `<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
          <pattern id="golfPattern" width="30" height="30" patternUnits="userSpaceOnUse">
            <circle cx="15" cy="15" r="1" fill="white" />
            <circle cx="0" cy="0" r="1" fill="white" />
            <circle cx="0" cy="30" r="1" fill="white" />
            <circle cx="30" cy="0" r="1" fill="white" />
            <circle cx="30" cy="30" r="1" fill="white" />
          </pattern>
          <rect width="100%" height="100%" fill="url(#golfPattern)" />
        </svg>`;
        header.appendChild(pattern);
        
        // Profile image
        const imageContainer = document.createElement('div');
        imageContainer.className = 'profile-image-container';
        
        const profileImage = document.createElement('img');
        profileImage.src = enhancedData.profileImage;
        profileImage.alt = memberName;
        profileImage.className = 'profile-image';
        imageContainer.appendChild(profileImage);
        
        header.appendChild(imageContainer);
        card.appendChild(header);
        
        // Card body
        const body = document.createElement('div');
        body.className = 'card-body-premium';
        
        // Member name
        const nameElement = document.createElement('h3');
        nameElement.className = 'member-name';
        nameElement.textContent = memberName;
        body.appendChild(nameElement);
        
        // Nickname
        const nickname = document.createElement('p');
        nickname.className = 'member-nickname';
        nickname.textContent = `"${enhancedData.nickname}"`;
        body.appendChild(nickname);
        
        // Handicap badge
        const handicapBadge = document.createElement('div');
        handicapBadge.className = 'handicap-badge';
        handicapBadge.textContent = handicapData ? `Handicap: ${handicapData.index}` : 'No Handicap';
        body.appendChild(handicapBadge);
        
        // Bio
        const bio = document.createElement('p');
        bio.className = 'member-bio';
        bio.textContent = enhancedData.bio;
        body.appendChild(bio);
        
        // Stats grid
        const statsGrid = document.createElement('div');
        statsGrid.className = 'stats-grid';
        
        // Avg Score stat
        const avgScoreStat = document.createElement('div');
        avgScoreStat.className = 'stat-box';
        
        const avgScoreLabel = document.createElement('div');
        avgScoreLabel.className = 'stat-label';
        avgScoreLabel.textContent = 'Avg Score';
        
        const avgScoreValue = document.createElement('div');
        avgScoreValue.className = 'stat-value';
        
        // Calculate average score if recent scores exist
        if (recentScores && recentScores.length > 0) {
          const totalScore = recentScores.reduce((sum, score) => sum + score.totalShots, 0);
          const avgScore = Math.round(totalScore / recentScores.length);
          avgScoreValue.textContent = avgScore;
        } else {
          avgScoreValue.textContent = 'N/A';
        }
        
        avgScoreStat.appendChild(avgScoreLabel);
        avgScoreStat.appendChild(avgScoreValue);
        statsGrid.appendChild(avgScoreStat);
        
        // Member since stat
        const joinedStat = document.createElement('div');
        joinedStat.className = 'stat-box';
        
        const joinedLabel = document.createElement('div');
        joinedLabel.className = 'stat-label';
        joinedLabel.textContent = 'Member Since';
        
        const joinedValue = document.createElement('div');
        joinedValue.className = 'stat-value';
        
        // Show year from joined date
        const joinDate = new Date(enhancedData.joined);
        joinedValue.textContent = joinDate.getFullYear();
        
        joinedStat.appendChild(joinedLabel);
        joinedStat.appendChild(joinedValue);
        statsGrid.appendChild(joinedStat);
        
        body.appendChild(statsGrid);
        
        // View profile button
        const viewProfileBtn = document.createElement('button');
        viewProfileBtn.className = 'btn btn-sm view-profile-btn';
        viewProfileBtn.textContent = 'View Profile';
        viewProfileBtn.dataset.member = memberName;
        viewProfileBtn.style.width = '100%';
        body.appendChild(viewProfileBtn);
        
        card.appendChild(body);
        
        // Card footer
        const footer = document.createElement('div');
        footer.className = 'card-footer-premium';
        
        const favCourseLabel = document.createElement('div');
        favCourseLabel.className = 'stat-label';
        favCourseLabel.textContent = 'Favorite Course';
        
        const favCourseValue = document.createElement('div');
        favCourseValue.className = 'text-sm font-medium text-gray-800 truncate';
        favCourseValue.textContent = enhancedData.favoriteCourse;
        
        footer.appendChild(favCourseLabel);
        footer.appendChild(favCourseValue);
        
        card.appendChild(footer);
        
        return card;
      }
      
      /**
       * Create a list card for premium member display
       */
      function createListCard(memberName, handicapData, recentScores, enhancedData) {
        const card = document.createElement('div');
        card.className = 'premium-member-list-item';
        card.dataset.member = memberName;
        
        // Left column with photo and basic info
        const leftColumn = document.createElement('div');
        leftColumn.className = 'list-item-left';
        
        // Profile image
        const profileImage = document.createElement('img');
        profileImage.src = enhancedData.profileImage;
        profileImage.alt = memberName;
        profileImage.className = 'profile-image mb-3';
        leftColumn.appendChild(profileImage);
        
        // Member name
        const nameElement = document.createElement('h3');
        nameElement.className = 'text-xl font-bold text-center mb-1';
        nameElement.textContent = memberName;
        leftColumn.appendChild(nameElement);
        
        // Nickname
        const nickname = document.createElement('p');
        nickname.className = 'text-green-100 text-sm italic mb-3';
        nickname.textContent = `"${enhancedData.nickname}"`;
        leftColumn.appendChild(nickname);
        
        // Handicap badge
        const handicapBadge = document.createElement('div');
        handicapBadge.className = 'bg-white text-green-800 font-bold px-4 py-1 rounded-full text-sm mb-3';
        handicapBadge.textContent = handicapData ? `Handicap: ${handicapData.index}` : 'No Handicap';
        leftColumn.appendChild(handicapBadge);
        
        // Member since
        const joinedText = document.createElement('div');
        joinedText.className = 'text-green-100 text-xs';
        joinedText.textContent = `Member since ${new Date(enhancedData.joined).getFullYear()}`;
        leftColumn.appendChild(joinedText);
        
        card.appendChild(leftColumn);
        
        // Right column with details
        const rightColumn = document.createElement('div');
        rightColumn.className = 'list-item-right';
        
        // Bio
        const bio = document.createElement('p');
        bio.className = 'text-gray-600 mb-4';
        bio.textContent = enhancedData.bio;
        rightColumn.appendChild(bio);
        
        // Stats grid
        const statsGrid = document.createElement('div');
        statsGrid.className = 'grid grid-cols-2 md:grid-cols-4 gap-4 mb-4';
        
        // Quick stats
        const quickStats = [
          { label: 'Avg Score', value: getAverageScore(recentScores) },
          { label: 'Last Round', value: getLastRound(recentScores) },
          { label: 'Favorite Club', value: enhancedData.favoriteClub },
          { label: 'Favorite Course', value: enhancedData.favoriteCourse }
        ];
        
        quickStats.forEach(stat => {
          const statBox = document.createElement('div');
          statBox.className = 'bg-gray-50 p-3 rounded';
          
          const statLabel = document.createElement('div');
          statLabel.className = 'text-xs text-gray-500';
          statLabel.textContent = stat.label;
          
          const statValue = document.createElement('div');
          statValue.className = 'font-bold text-gray-800';
          statValue.textContent = stat.value;
          
          statBox.appendChild(statLabel);
          statBox.appendChild(statValue);
          statsGrid.appendChild(statBox);
        });
        
        rightColumn.appendChild(statsGrid);
        
        // Achievements tags
        const achievementsContainer = document.createElement('div');
        achievementsContainer.className = 'flex flex-wrap gap-2 mb-4';
        
        // Show first 2 achievements and a +X more if there are more
        enhancedData.achievements.slice(0, 2).forEach(achievement => {
          const achievementTag = document.createElement('span');
          achievementTag.className = 'achievement-tag';
          achievementTag.textContent = achievement;
          achievementsContainer.appendChild(achievementTag);
        });
        
        if (enhancedData.achievements.length > 2) {
          const moreTag = document.createElement('span');
          moreTag.className = 'achievement-tag';
          moreTag.style.backgroundColor = '#f0f0f0';
          moreTag.style.color = '#666';
          moreTag.textContent = `+${enhancedData.achievements.length - 2} more`;
          achievementsContainer.appendChild(moreTag);
        }
        
        rightColumn.appendChild(achievementsContainer);
        
        // View profile button
        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'text-right';
        
        const viewProfileBtn = document.createElement('button');
        viewProfileBtn.className = 'btn btn-sm view-profile-btn';
        viewProfileBtn.textContent = 'View Full Profile';
        viewProfileBtn.dataset.member = memberName;
        buttonContainer.appendChild(viewProfileBtn);
        
        rightColumn.appendChild(buttonContainer);
        
        card.appendChild(rightColumn);
        
        return card;
      }
      
      /**
       * Refresh the members list based on search and sort criteria
       */
      function refreshMembersList(searchText = '') {
        const currentView = gridButton.classList.contains('active') ? 'grid' : 'list';
        const sortValue = sortSelect.value;
        const membersContainer = document.getElementById('members-container');
        
        // Clear current members
        membersContainer.innerHTML = '';
        
        // Get all members
        const members = Object.keys(enhancedMemberData);
        
        // Filter by search text
        const filteredMembers = members.filter(member => {
          const data = enhancedMemberData[member];
          return (
            member.toLowerCase().includes(searchText) ||
            data.nickname.toLowerCase().includes(searchText)
          );
        });
        
        // Sort members
        filteredMembers.sort((a, b) => {
          const dataA = enhancedMemberData[a];
          const dataB = enhancedMemberData[b];
          
          if (sortValue === 'handicap') {
            const handicapA = dataA.handicap ? parseFloat(dataA.handicap) : 999;
            const handicapB = dataB.handicap ? parseFloat(dataB.handicap) : 999;
            return handicapA - handicapB;
          } else if (sortValue === 'joined') {
            return new Date(dataB.joined) - new Date(dataA.joined);
          } else {
            return a.localeCompare(b); // Default: sort by name
          }
        });
        
        // Show or hide no results message
        const noResults = document.getElementById('no-results');
        if (filteredMembers.length === 0) {
          noResults.classList.remove('hidden');
        } else {
          noResults.classList.add('hidden');
          
          // Create and append member cards
          filteredMembers.forEach(member => {
            const data = enhancedMemberData[member];
            const handicapData = data.handicap ? { index: data.handicap } : null;
            const recentScores = data.recentScores || [];
            
            if (currentView === 'grid') {
              membersContainer.appendChild(createGridCard(member, handicapData, recentScores, data));
            } else {
              membersContainer.appendChild(createListCard(member, handicapData, recentScores, data));
            }
          });
          
          // Re-attach event listeners to view profile buttons
          document.querySelectorAll('.view-profile-btn').forEach(btn => {
            btn.addEventListener('click', function() {
              const memberName = this.dataset.member;
              openMemberModal(memberName);
            });
          });
        }
      }
      
      /**
       * Setup modal interaction
       */
      function setupModalInteraction() {
        const modal = document.getElementById('member-modal');
        const closeButtons = document.querySelectorAll('#modal-close, #modal-close-btn');
        
        // Close modal when clicking close buttons
        closeButtons.forEach(button => {
          button.addEventListener('click', function() {
            modal.style.display = 'none';
          });
        });
        
        // Close modal when clicking outside
        modal.addEventListener('click', function(event) {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        });
        
        // Setup tabs
        const tabs = document.querySelectorAll('.modal-tab');
        tabs.forEach(tab => {
          tab.addEventListener('click', function() {
            const tabName = this.dataset.tab;
            
            // Update active tab
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Show active content section
            const contentSections = document.querySelectorAll('.modal-content-section');
            contentSections.forEach(section => {
              section.classList.remove('active');
            });
            
            document.getElementById(`${tabName}-section`).classList.add('active');
          });
        });
      }
      
      /**
       * Open member modal with details
       */
      function openMemberModal(memberName) {
        const memberData = enhancedMemberData[memberName];
        if (!memberData) return;
        
        const modal = document.getElementById('member-modal');
        
        // Set header info
        document.getElementById('modal-profile-image').src = memberData.profileImage;
        document.getElementById('modal-name').textContent = memberData.name;
        document.getElementById('modal-nickname').textContent = `"${memberData.nickname}"`;
        document.getElementById('modal-handicap').textContent = `Handicap: ${memberData.handicap || 'N/A'}`;
        
        // About tab
        document.getElementById('about-name').textContent = memberData.name;
        document.getElementById('about-bio').textContent = memberData.bio;
        document.getElementById('about-detail').textContent = memberData.about;
        
        // Preferences list
        const preferencesList = document.getElementById('member-preferences');
        preferencesList.innerHTML = '';
        
        const preferences = [
          { label: 'Favorite Club', value: memberData.favoriteClub },
          { label: 'Favorite Course', value: memberData.favoriteCourse },
          { label: 'Member Since', value: BBB_UTILS.formatDate(memberData.joined, 'short') }
        ];
        
        preferences.forEach(pref => {
          const listItem = document.createElement('li');
          listItem.className = 'flex items-center gap-2';
          listItem.innerHTML = `
            <span class="text-green-600">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
            </span>
            <span><strong>${pref.label}:</strong> ${pref.value}</span>
          `;
          preferencesList.appendChild(listItem);
        });
        
        // Stats tab
        if (memberData.stats) {
          const stats = memberData.stats;
          
          // Set progress bars
          document.getElementById('driving-accuracy').textContent = `${stats.drivingAccuracy}%`;
          document.getElementById('driving-accuracy-bar').style.width = `${stats.drivingAccuracy}%`;
          
          document.getElementById('gir').textContent = `${stats.greensInRegulation}%`;
          document.getElementById('gir-bar').style.width = `${stats.greensInRegulation}%`;
          
          document.getElementById('putting-avg').textContent = `${stats.puttingAvg} putts`;
          document.getElementById('putting-avg-bar').style.width = `${(3 - stats.puttingAvg) / 1.5 * 100}%`;
          
          document.getElementById('scoring-avg').textContent = stats.scoringAvg;
          document.getElementById('scoring-avg-bar').style.width = `${100 - (stats.scoringAvg - 70)}%`;
          
          // Set stat values
          document.getElementById('avg-score-value').textContent = stats.scoringAvg;
          document.getElementById('handicap-value').textContent = memberData.handicap || 'N/A';
          document.getElementById('gir-value').textContent = `${stats.greensInRegulation}%`;
          document.getElementById('putting-value').textContent = stats.puttingAvg;
        }
        
        // Scores tab
        const scoresTableBody = document.getElementById('scores-table-body');
        scoresTableBody.innerHTML = '';
        
        if (memberData.recentScores && memberData.recentScores.length > 0) {
          memberData.recentScores.forEach((score, index) => {
            const row = document.createElement('tr');
            row.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
            
            const dateCell = document.createElement('td');
            dateCell.className = 'py-4 px-4 border-b text-sm text-gray-500';
            dateCell.textContent = BBB_UTILS.formatDate(score.date, 'short');
            
            const courseCell = document.createElement('td');
            courseCell.className = 'py-4 px-4 border-b text-sm font-medium text-gray-900';
            courseCell.textContent = score.course;
            
            const teeCell = document.createElement('td');
            teeCell.className = 'py-4 px-4 border-b text-sm text-gray-500';
            teeCell.textContent = BBB_CONFIG.teeColors[score.tee] || score.tee;
            
            const scoreCell = document.createElement('td');
            scoreCell.className = 'py-4 px-4 border-b text-sm font-medium text-gray-900';
            scoreCell.textContent = score.totalShots;
            
            const pointsCell = document.createElement('td');
            pointsCell.className = 'py-4 px-4 border-b text-sm text-gray-500';
            pointsCell.textContent = `${score.stablefordPoints} pts`;
            
            row.appendChild(dateCell);
            row.appendChild(courseCell);
            row.appendChild(teeCell);
            row.appendChild(scoreCell);
            row.appendChild(pointsCell);
            
            scoresTableBody.appendChild(row);
          });
        } else {
          const noScoresRow = document.createElement('tr');
          const noScoresCell = document.createElement('td');
          noScoresCell.colSpan = 5;
          noScoresCell.className = 'py-4 px-4 text-center text-gray-500';
          noScoresCell.textContent = 'No recent scores available';
          noScoresRow.appendChild(noScoresCell);
          scoresTableBody.appendChild(noScoresRow);
        }
        
        // Achievements tab
        const achievementsGrid = document.getElementById('achievements-grid');
        achievementsGrid.innerHTML = '';
        
        memberData.achievements.forEach((achievement, index) => {
          const achievementCard = document.createElement('div');
          achievementCard.className = 'bg-white p-4 rounded-lg border border-gray-200 flex items-start gap-3';
          
          achievementCard.innerHTML = `
            <div class="flex-shrink-0">
              <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                </svg>
              </div>
            </div>
            <div>
              <div class="font-medium text-gray-900">${achievement}</div>
              <div class="text-sm text-gray-500">Birdie Bush Bandits</div>
            </div>
          `;
          
          achievementsGrid.appendChild(achievementCard);
        });
        
        if (memberData.achievements.length === 0) {
          const noAchievements = document.createElement('div');
          noAchievements.className = 'text-center py-8 text-gray-500';
          noAchievements.textContent = 'No achievements recorded yet';
          achievementsGrid.appendChild(noAchievements);
        }
        
        // Reset to About tab
        document.querySelectorAll('.modal-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelector('.modal-tab[data-tab="about"]').classList.add('active');
        
        document.querySelectorAll('.modal-content-section').forEach(section => {
          section.classList.remove('active');
        });
        document.getElementById('about-section').classList.add('active');
        
        // Show modal
        modal.style.display = 'flex';
      }
      
      /**
       * Helper functions for enhanced member display
       */
      
      // Generate a random golf nickname
      function generateNickname(name) {
        const nicknames = [
          'The Drive Master',
          'Straight Shooter',
          'Birdie Hunter',
          'The Putter',
          'Smooth Swing',
          'Eagle Eye',
          'The Recovery King',
          'Short Game Wizard',
          'Sand Escape Artist',
          'The Consistent One'
        ];
        
        // Use a deterministic approach based on name to always get the same nickname
        const nameSum = name.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);
        return nicknames[nameSum % nicknames.length];
      }
      
      // Generate a bio for a member
      function generateBio(name) {
        const bios = [
          `${name} is known for a smooth swing and consistent play. Always friendly on the course, ${name} has a competitive edge when it counts.`,
          `Weekend warrior with a passion for the back nine. ${name} has been playing golf for years and especially enjoys links-style courses.`,
          `Former college player who still has a mean swing. ${name} brings experience and skill to every round played with the Bandits.`,
          `New to golf but improving quickly. ${name} loves the driving range and is dedicated to lowering that handicap every season.`,
          `${name} is a natural athlete who took up golf later in life. What ${name} lacks in experience is made up for in raw talent and enthusiasm.`
        ];
        
        const nameSum = name.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);
        return bios[nameSum % bios.length];
      }
      
      // Generate additional about info
      function generateAbout(name) {
        const abouts = [
          `${name} started playing golf after retirement and quickly fell in love with the game. Now spends weekends at the course and is always looking for new playing partners.`,
          `A lifelong golfer, ${name} competed at the junior level before pursuing other interests. Now back to the game with renewed passion and making up for lost time.`,
          `${name} analyzes every aspect of the golf swing with multiple apps and gadgets. Has taken lessons from three different pros and owns more golf books than rounds played.`,
          `Started playing golf as a way to network professionally, but ${name} soon became addicted to the challenge and beauty of the game. Now plays at least once a week year-round.`,
          `${name} approaches golf with a relaxed attitude, enjoying the camaraderie as much as the game itself. Known for bringing great snacks and keeping the mood light during tough rounds.`
        ];
        
        const nameSum = name.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);
        return abouts[(nameSum + 2) % abouts.length]; // +2 to get different from bio
      }
      
      // Get random favorite club
      function getRandomFavoriteClub() {
        const clubs = ['Driver', '3 Wood', '5 Wood', '4 Iron', '5 Iron', '7 Iron', '9 Iron', 'Pitching Wedge', 'Sand Wedge', 'Putter'];
        return clubs[Math.floor(Math.random() * clubs.length)];
      }
      
      // Get random course
      function getRandomCourse() {
        const courses = [
          'Pine Valley Golf Club',
          'Oakmont Country Club',
          'Birdie Bush Links',
          'Green Meadows Golf Course',
          'Augusta National',
          'St Andrews Links',
          'Pebble Beach',
          'Torrey Pines',
          'Bethpage Black',
          'Whistling Straits'
        ];
        return courses[Math.floor(Math.random() * courses.length)];
      }
      
      // Generate achievements
      function generateAchievements() {
        const allAchievements = [
          'Club Champion 2023',
          'Longest Drive Winner',
          'First Hole-in-One',
          'Most Improved 2024',
          'Putting Champion',
          'Tournament Winner: Spring Classic',
          'Course Record',
          'Most Birdies in a Season',
          'Charity Tournament Organizer',
          'Lowest Handicap Improvement'
        ];
        
        // Get 0-3 random achievements
        const count = Math.floor(Math.random() * 4);
        const achievements = [];
        
        for (let i = 0; i < count; i++) {
          const index = Math.floor(Math.random() * allAchievements.length);
          achievements.push(allAchievements[index]);
          allAchievements.splice(index, 1); // Remove to avoid duplicates
        }
        
        return achievements;
      }
      
      // Generate stats based on handicap
      function generateStats(handicap) {
        // Convert handicap to number if it's a string
        const handicapNum = typeof handicap === 'string' ? parseFloat(handicap) : handicap;
        
        // Approximate stats based on handicap
        // Better players have better stats
        const drivingAccuracy = Math.max(30, Math.min(90, 100 - handicapNum * 2));
        const greensInRegulation = Math.max(20, Math.min(80, 90 - handicapNum * 2));
        const puttingAvg = Math.max(1.5, Math.min(2.5, 1.5 + handicapNum * 0.03));
        const scoringAvg = Math.max(70, 72 + handicapNum);
        
        return {
          drivingAccuracy: Math.round(drivingAccuracy),
          greensInRegulation: Math.round(greensInRegulation),
          puttingAvg: puttingAvg.toFixed(1),
          scoringAvg: scoringAvg.toFixed(1)
        };
      }
      
      // Get average score from recent scores
      function getAverageScore(recentScores) {
        if (!recentScores || recentScores.length === 0) {
          return 'N/A';
        }
        
        const totalScore = recentScores.reduce((sum, score) => sum + score.totalShots, 0);
        return Math.round(totalScore / recentScores.length);
      }
      
      // Get last round date
      function getLastRound(recentScores) {
        if (!recentScores || recentScores.length === 0) {
          return 'N/A';
        }
        
        // Scores should already be sorted by date descending
        return BBB_UTILS.formatDate(recentScores[0].date, 'short');
      }
    });
  </script>
</body>
</html>
