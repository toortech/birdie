<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stableford Scorecard – Multiple Courses</title>
  <style>
    body { background: #007BFF; color: white; font-family: sans-serif; padding: 1rem; margin: 0 auto; }
    h1 { color: #28A745; font-size: 2rem; text-align: center; margin-bottom: 1rem; }
    .controls { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
    .controls > div { background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 6px; flex: 1 1 200px; }
    label { display: block; font-weight: bold; margin-bottom: 0.25rem; }
    #table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; min-width: 600px; }
    th, td { border: 1px solid #fff; padding: 0.5rem; text-align: center; }
    th { background: rgba(255,255,255,0.2); }
    input[type="number"] { width: 3rem; }
    select { padding: 0.25rem; width: 100%; }
    button { padding: 0.5rem 1rem; font-size: 1rem; background: #28A745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #1e7e34; }
    #button-group { display: flex; gap: 1rem; margin-bottom: 1rem; justify-content: center; }
    @media (max-width: 768px) {
      h1 { font-size: 1.5rem; }
      .controls { flex-direction: column; }
      .controls > div { flex: 1 1 auto; }
      input[type="number"] { width: 2rem; }
      table { font-size: 0.9rem; }
    }
    @media (max-width: 480px) {
      body { padding: 0.5rem; }
      h1 { font-size: 1.25rem; }
      input[type="number"] { width: 1.5rem; }
      select, button { font-size: 0.9rem; }
      th, td { padding: 0.3rem; }
      #button-group { flex-direction: column; align-items: center; }
    }
  </style>
</head>
<body>
  <h1>Stableford Scorecard – Multiple Courses</h1>

  <div class="controls">
    <div>
      <label for="course-select">Course:</label>
      <select id="course-select">
        <option value="Ritchings">Richings Park</option>
        <option value="Thorney">Thorney Park</option>
      </select>
    </div>
    <div>
      <label for="tee-select">Tee Colour:</label>
      <select id="tee-select">
        <option value="white">White</option>
        <option value="yellow">Yellow</option>
        <option value="red">Red</option>
      </select>
    </div>
    <div>
      <label>Players:</label>
      <label><input type="checkbox" value="Amrit"> Amrit</label>
      <label><input type="checkbox" value="Kam"> Kam</label>
      <label><input type="checkbox" value="Vish"> Vish</label>
      <label><input type="checkbox" value="Ravi"> Ravi</label>
      <label><input type="checkbox" value="Bal"> Bal</label>
    </div>
    <div>
      <label>Holes:</label>
      <label><input type="radio" name="holes" value="18" checked> Full 18</label>
      <label><input type="radio" name="holes" value="9f"> Front 9</label>
      <label><input type="radio" name="holes" value="9b"> Back 9</label>
    </div>
  </div>

  <div id="button-group">
    <button id="build">Build Scorecard</button>
    <button id="reset">Reset</button>
  </div>

  <div id="created-time" style="margin-top:0.5rem;font-style:italic;"></div>
  <div id="table-container"></div>

  <script>
    const buildBtn = document.getElementById('build');
    const resetBtn = document.getElementById('reset');
    const tableContainer = document.getElementById('table-container');
    const createdTime = document.getElementById('created-time');

    buildBtn.addEventListener('click', () => {
      build();
    });

    resetBtn.addEventListener('click', () => {
      if (confirm('Are you sure you want to reset the scorecard?')) {
        tableContainer.innerHTML = '';
        createdTime.textContent = '';
      }
    });

    function build() {
      const courses = {
        Ritchings: { par: [4,3,5,4,4,3,4,4,4,3,4,4,4,3,4,4,5,4], si: [12,8,6,18,10,16,2,14,4,15,3,17,7,11,1,5,13,9] },
        Thorney:   { par: [5,4,4,3,5,4,4,3,5,4,4,3,5,4,4,3,5,4], si: [9,15,1,17,5,13,3,11,7,16,2,14,6,18,4,12,8,10] }
      };
      const teeSlope = { white:128, yellow:121, red:115 };

      const courseKey = document.getElementById('course-select').value;
      const { par, si } = courses[courseKey];
      const tee = document.getElementById('tee-select').value;
      const slope = teeSlope[tee];
      const players = [...document.querySelectorAll('input[type=checkbox]:checked')].map(cb => cb.value);
      const holes = document.querySelector('input[name=holes]:checked').value;
      let indices = [...Array(18).keys()];
      if (holes === '9f') indices = indices.slice(0,9);
      if (holes === '9b') indices = indices.slice(9);

      if (!players.length) {
        alert("Please select at least one player.");
        return;
      }

      createdTime.textContent = `Scorecard created: ${new Date().toLocaleString()}`;
      tableContainer.innerHTML = '';

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      let hdr1 = '<tr><th>Hole</th><th>Par</th><th>SI</th>';
      players.forEach((p,i) => hdr1 += `<th colspan="2">${p}<br>HCP:<input id="hcp-${i}" type="number" value="0" min="0" max="36"></th>`);
      hdr1 += '</tr>';
      let hdr2 = '<tr><th></th><th></th><th></th>';
      players.forEach(() => hdr2 += '<th>Score</th><th>Pts</th>');
      hdr2 += '</tr>';
      thead.innerHTML = hdr1 + hdr2;
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      indices.forEach(i => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td><td>${par[i]}</td><td>${si[i]}</td>`;
        players.forEach((_,pi) => tr.innerHTML += `<td><input data-player="${pi}" data-hole="${i}" type="number" min="0"></td><td class="pts-${pi}"></td>`);
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      const tfoot = document.createElement('tfoot');
      ['Front 9','Back 9','Overall'].forEach((lbl,ri) => {
        let row = `<tr><td colspan="3">${lbl} Total</td>`;
        players.forEach((_,pi) => row += `<td id="str-${ri}-${pi}"></td><td id="pts-${ri}-${pi}"></td>`);
        row += '</tr>';
        tfoot.innerHTML += row;
      });
      table.appendChild(tfoot);

      tableContainer.appendChild(table);

      players.forEach((_,i) => {
        const hcpInput = document.getElementById(`hcp-${i}`);
        const adjSpan = document.createElement('span');
        adjSpan.id = `adjhcp-${i}`;
        adjSpan.textContent = '0';
        hcpInput.insertAdjacentText('afterend', ' Adj:');
        hcpInput.insertAdjacentElement('afterend', adjSpan);
        function updateAdj() {
          const raw = parseInt(hcpInput.value,10) || 0;
          const adj = Math.round(raw * slope/113);
          adjSpan.textContent = adj;
        }
        hcpInput.addEventListener('input', () => { updateAdj(); update(table,par,si,players,indices,slope); });
        updateAdj();
      });

      tbody.querySelectorAll('input[type=number]').forEach(inp => inp.addEventListener('input', () => update(table,par,si,players,indices,slope)));

      update(table,par,si,players,indices,slope);
    }

    function update(table, par, siArr, players, indices, slope) {
      const totals = players.map(() => ({fS:0,fP:0,bS:0,bP:0,oS:0,oP:0}));
      table.querySelectorAll('tbody tr').forEach((tr,idx) => {
        const h = indices[idx];
        const pr = par[h], sidx = siArr[h];
        const front = idx < 9;
        players.forEach((_,pi) => {
          const inp = tr.querySelector(`input[data-player="${pi}"][data-hole="${h}"]`);
          const sc = parseInt(inp.value,10);
          const ptsCell = tr.querySelector(`.pts-${pi}`);
          if (isNaN(sc)) { ptsCell.textContent=''; return; }

          const rawHcp = parseInt(document.getElementById(`hcp-${pi}`).value,10)||0;
          const adjHcp = Math.round(rawHcp * slope/113);
          const strokesGiven = adjHcp;
          const net = sc - strokesGiven;

          let pts=0;
          if(net <= pr-2) pts=4;
          else if(net===pr-1) pts=3;
          else if(net===pr) pts=2;
          else if(net===pr+1) pts=1;
          ptsCell.textContent = pts;

          totals[pi].oS += sc;
          if(front) totals[pi].fS += sc; else totals[pi].bS += sc;
          totals[pi].oP += pts;
          if(front) totals[pi].fP += pts; else totals[pi].bP += pts;
        });
      });
      totals.forEach((t,pi) => [0,1,2].forEach(r => {
        document.getElementById(`str-${r}-${pi}`).textContent = r===0? t.fS: r===1? t.bS: t.oS;
        document.getElementById(`pts-${r}-${pi}`).textContent = r===0? t.fP: r===1? t.bP: t.oP;
      }));
    }
  </script>
</body>
</html>
