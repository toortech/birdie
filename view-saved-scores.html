<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Past Scorecards</title>
  <style>
    body { background-color: #007BFF; font-family: sans-serif; color: white; max-width: 1000px; margin: auto; padding: 1rem; }
    h1 { text-align: center; color: #28A745; }
    .scorecard { background: rgba(255,255,255,0.1); padding: 1rem; margin-bottom: 1rem; border-radius: 8px; }
    .scorecard h3 { margin: 0 0 0.5rem; color: #FFD700; }
    .summary-table, .hole-table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    .summary-table th, .summary-table td, .hole-table th, .hole-table td { border: 1px solid #fff; padding: 0.3rem; text-align: center; font-size: 0.9rem; }
    .hole-table { margin-top: 1rem; display: none; }
    .toggle-btn { margin-top: 0.5rem; background: #28A745; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.9rem; }
    .toggle-btn:hover { background: #1e7e34; }
    .filter-group { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
    .filter-group label { font-weight: bold; }
    select, input[type="text"] { padding: 0.5rem; border-radius: 4px; border: none; }
    a.back-link { display: block; margin-top: 2rem; text-align: center; color: #FFFFFF; font-weight: bold; text-decoration: underline; }
  </style>
</head>
<body>
  <h1>üìÑ Past Scorecards</h1>
  <div class="filter-group">
    <div>
      <label for="course-filter">Course:</label>
      <select id="course-filter"></select>
    </div>
    <div>
      <label for="month-filter">Month:</label>
      <select id="month-filter"></select>
    </div>
    <div>
      <label for="player-filter">Player:</label>
      <input type="text" id="player-filter" placeholder="Search by player">
    </div>
  </div>
  <div id="scorecard-list"></div>
  <a class="back-link" href="scorecards.html">‚Üê Back to Scorecard</a>

  <script>
    const allScorecards = JSON.parse(localStorage.getItem('scorecards') || '[]');
    const listEl = document.getElementById('scorecard-list');
    const courseFilter = document.getElementById('course-filter');
    const monthFilter = document.getElementById('month-filter');
    const playerFilter = document.getElementById('player-filter');

    const courses = [...new Set(allScorecards.map(s => s.course))];
    courses.unshift("All");
    courses.forEach(c => {
      const o = document.createElement('option');
      o.value = c; o.textContent = c;
      courseFilter.appendChild(o);
    });

    const months = [...new Set(allScorecards.map(s => s.date.slice(0,7)))];
    months.unshift("All");
    months.forEach(m => {
      const o = document.createElement('option');
      o.value = m; o.textContent = m;
      monthFilter.appendChild(o);
    });

    function render() {
      const course = courseFilter.value;
      const month = monthFilter.value;
      const playerSearch = playerFilter.value.toLowerCase();
      listEl.innerHTML = '';
      let filtered = allScorecards;
      if (course !== "All") filtered = filtered.filter(s => s.course === course);
      if (month !== "All") filtered = filtered.filter(s => s.date.startsWith(month));
      if (playerSearch) filtered = filtered.filter(s => s.players.some(p => p.toLowerCase().includes(playerSearch)));

      if (!filtered.length) {
        listEl.innerHTML = '<p>No matching scorecards.</p>';
        return;
      }

      filtered.forEach((sc, index) => {
        const div = document.createElement('div');
        div.className = 'scorecard';
        const d = new Date(sc.date);
        div.innerHTML = `
          <h3>${sc.course} (${sc.tee}) ‚Äì ${d.toLocaleString()}</h3>
          <table class="summary-table">
            <thead><tr><th>Player</th><th>Handicap</th><th>Total Strokes</th><th>Total Points</th></tr></thead>
            <tbody>
              ${sc.players.map((p, i) => {
                const hcp = sc.handicaps.find(h => h.player == i)?.hcp || "-";
                const scores = sc.scores.filter(s => s.player == i);
                const totalStrokes = scores.reduce((sum, s) => sum + parseInt(s.value || 0), 0);
                return `<tr><td>${p}</td><td>${hcp}</td><td>${totalStrokes}</td><td>-</td></tr>`;
              }).join('')}
            </tbody>
          </table>
          <button class="toggle-btn" data-index="${index}">Show Details</button>
          <table class="hole-table" id="details-${index}">
            <thead>
              <tr><th>Player</th>${Array.from({length:18}, (_,i) => `<th>H${i+1}</th>`).join('')}</tr>
            </thead>
            <tbody>
              ${sc.players.map((p, i) => {
                const scores = sc.scores.filter(s => s.player == i);
                const holes = Array(18).fill('').map((_,h) => scores.find(s => parseInt(s.hole) === h)?.value || '');
                return `<tr><td>${p}</td>${holes.map(v => `<td>${v}</td>`).join('')}</tr>`;
              }).join('')}
            </tbody>
          </table>
        `;
        listEl.appendChild(div);
      });

      document.querySelectorAll('.toggle-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = btn.getAttribute('data-index');
          const table = document.getElementById(`details-${idx}`);
          const show = table.style.display !== 'table';
          table.style.display = show ? 'table' : 'none';
          btn.textContent = show ? 'Hide Details' : 'Show Details';
        });
      });
    }

    courseFilter.addEventListener('change', render);
    monthFilter.addEventListener('change', render);
    playerFilter.addEventListener('input', render);

    render();
  </script>
</body>
</html>
