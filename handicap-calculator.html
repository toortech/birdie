<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Birdie Bush Bandits – Handicap Calculator</title>
  <meta name="description" content="Calculate your golf handicap using the World Handicap System standard.">
  <link rel="icon" type="image/svg+xml" href="bbb-logo.svg">
  
  <!-- Add Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">
  
  <!-- Global CSS -->
  <link rel="stylesheet" href="css/style.css">
  
  <style>
    /* Enhanced CSS Variables - Same as about.html */
    :root {
      --bbb-primary: #004d00;
      --bbb-secondary: #0046ad;
      --bbb-gold: #ffd700;
      --bbb-light-green: #e8f5e8;
      --bbb-background: #f5f5f5;
      --bbb-text: #212529;
      --bbb-text-muted: #6c757d;
      --bbb-border: #dee2e6;
      --font-family-base: 'Inter', sans-serif;
      --font-family-accent: 'Montserrat', serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family-base);
      line-height: 1.6;
      color: var(--bbb-text);
      background: linear-gradient(135deg, var(--bbb-light-green) 0%, var(--bbb-background) 100%);
      min-height: 100vh;
    }

    /* Header with Logo - Same as about.html */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
    }

    .header-logo {
      height: 50px;
      width: auto;
      transition: transform 0.3s ease;
    }

    .header-logo:hover {
      transform: scale(1.05);
    }

    .header-title {
      font-family: var(--font-family-accent);
      color: var(--bbb-primary);
      font-size: 1.5rem;
      font-weight: 700;
      margin-left: 1rem;
      text-decoration: none;
    }

    .header-title:hover {
      color: var(--bbb-secondary);
    }

    .header-left {
      display: flex;
      align-items: center;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .founded-badge-header {
      display: inline-block;
      background: var(--bbb-gold);
      color: var(--bbb-primary);
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-weight: 600;
      font-size: 0.8rem;
      margin-left: 1rem;
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
    }

    /* User info and auth controls */
    .user-info {
      color: var(--bbb-primary);
      font-weight: 500;
      font-size: 0.9rem;
    }

    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s;
    }

    .logout-btn:hover {
      background: #c82333;
    }

    .home-btn {
      background: var(--bbb-secondary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      text-decoration: none;
      display: inline-block;
      transition: background 0.3s;
    }

    .home-btn:hover {
      background: var(--bbb-primary);
    }

    /* Calculator Hero Section */
    .calculator-hero {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%);
      color: var(--bbb-text);
      text-align: center;
      padding: 4rem 2rem 3rem 2rem;
      position: relative;
      overflow: hidden;
      border-bottom: 3px solid #dee2e6;
      margin-top: 90px; /* Account for fixed header */
    }

    .calculator-hero::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0, 77, 0, 0.03) 0%, transparent 70%);
      animation: rotate 30s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .calculator-hero-content {
      position: relative;
      z-index: 2;
      max-width: 800px;
      margin: 0 auto;
    }

    .calculator-hero h1 {
      font-family: var(--font-family-accent);
      font-size: clamp(2rem, 4vw, 3.5rem);
      font-weight: 700;
      color: var(--bbb-primary);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      animation: fadeInUp 1s ease-out;
      margin: 0 0 1rem 0;
    }

    .calculator-hero .tagline {
      font-size: clamp(1rem, 2vw, 1.3rem);
      color: var(--bbb-text-muted);
      max-width: 600px;
      margin: 0 auto;
      animation: fadeInUp 1s ease-out 0.3s both;
      font-weight: 500;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .calculator-main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    /* Debug panel for development */
    .debug-panel {
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .debug-panel h4 {
      margin: 0 0 0.5rem 0;
      font-family: var(--font-family-accent);
      color: var(--bbb-primary);
    }

    .debug-status {
      margin: 0.5rem 0;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
    }

    .debug-status.success {
      background: #d4edda;
      color: #155724;
    }

    .debug-status.error {
      background: #f8d7da;
      color: #721c24;
    }

    .debug-status.warning {
      background: #fff3cd;
      color: #856404;
    }

    /* Member Selection Section */
    .member-selection-section {
      background: linear-gradient(135deg, var(--bbb-light-green), rgba(255, 215, 0, 0.1));
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      border-left: 4px solid var(--bbb-gold);
      transition: transform 0.3s ease;
    }

    .member-selection-section:hover {
      transform: translateX(10px);
    }

    .member-selection-section label {
      font-family: var(--font-family-accent);
      color: var(--bbb-primary);
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      display: block;
    }

    .member-select {
      width: 100%;
      max-width: 300px;
      padding: 0.75rem;
      border: 2px solid var(--bbb-border);
      border-radius: 8px;
      font-size: 1rem;
      background: white;
      font-family: var(--font-family-base);
      transition: border-color 0.3s ease;
    }

    .member-select:focus {
      outline: none;
      border-color: var(--bbb-secondary);
      box-shadow: 0 0 0 3px rgba(0, 70, 173, 0.1);
    }

    .admin-message {
      color: var(--bbb-text-muted);
      font-style: italic;
      margin-top: 0.5rem;
      font-family: var(--font-family-base);
    }

    /* Calculator Container */
    .calculator {
      background: white;
      padding: 3rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin: 4rem 0;
      border: 3px solid transparent;
      transition: all 0.3s ease;
    }

    .calculator:hover {
      border-color: var(--bbb-gold);
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }

    /* Buttons */
    .btn {
      background: var(--bbb-secondary);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-family: var(--font-family-accent);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 70, 173, 0.2);
      text-decoration: none;
      display: inline-block;
      text-align: center;
      margin: 0.25rem;
    }

    .btn:hover {
      background: var(--bbb-primary);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 70, 173, 0.3);
    }

    .btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn.debug {
      background: #17a2b8;
      font-size: 0.8rem;
      padding: 0.5rem 1rem;
    }

    .btn.debug:hover {
      background: #138496;
    }

    /* Status Messages */
    #status-message {
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 8px;
      text-align: center;
      display: none;
      font-family: var(--font-family-base);
      font-weight: 500;
    }

    .success {
      background: linear-gradient(135deg, #d4edda, #e8f5e9);
      color: #155724;
      border: 2px solid #c3e6cb;
    }

    .error {
      background: linear-gradient(135deg, #f8d7da, #ffebee);
      color: #721c24;
      border: 2px solid #f5c6cb;
    }

    .warning {
      background: linear-gradient(135deg, #fff3cd, #fffde7);
      color: #856404;
      border: 2px solid #ffeeba;
    }

    .info {
      background: linear-gradient(135deg, #d1ecf1, #e3f2fd);
      color: #0c5460;
      border: 2px solid #bee5eb;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .calculator {
        padding: 1.5rem;
        margin: 2rem 0;
      }
      
      .debug-panel {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>

  <!-- Fixed Header with Logo -->
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <a href="index.html">
          <img src="birdie.png" alt="Birdie Bush Bandits Logo" class="header-logo">
        </a>
        <a href="index.html" class="header-title">Birdie Bush Bandits</a>
        <div class="founded-badge-header">
          🏌️ Founded August 2020
        </div>
      </div>
      <div class="header-right">
        <a href="index.html" class="home-btn" id="home-link">Home</a>
      </div>
    </div>
  </header>
  
  <main id="main">
    <!-- Hero Section -->
    <section class="calculator-hero">
      <div class="calculator-hero-content">
        <h1>Handicap Calculator</h1>
        <p class="tagline">Calculate your official handicap using the World Handicap System</p>
      </div>
    </section>

    <!-- Main Calculator Content -->
    <div class="calculator-main">
      
      <!-- Debug Panel for Development -->
      <div class="debug-panel" id="debug-panel">
        <h4>Module Loading Status</h4>
        <div id="debug-content">Checking module status...</div>
        <button class="btn debug" onclick="checkModuleStatus()">Refresh Status</button>
        <button class="btn debug" onclick="testMemberLoading()">Test Member Loading</button>
        <button class="btn debug" onclick="forceLoadMembers()">Force Load Members</button>
      </div>
      
      <div id="status-message"></div>
      
      <div id="handicap-calculator" class="calculator">
        <!-- Member selection -->
        <div class="member-selection-section">
          <label for="member-select">Calculate Handicap For:</label>
          <select id="member-select" class="member-select">
            <option value="">Loading members...</option>
          </select>
          <div id="admin-message" class="admin-message" style="display: none;">
            <small>As an admin, you can calculate and save handicaps for any member.</small>
          </div>
        </div>
        
        <div style="text-align: center; padding: 2rem;">
          <p><strong>Member loading test in progress...</strong></p>
          <p>Check the debug panel above to see what's happening with module loading.</p>
        </div>
      </div>
    </div>
  </main>

  <!-- MODULE LOADING DIAGNOSTIC SCRIPT -->
  <script>
    console.log("=== BBB MODULE LOADING DIAGNOSTIC ===");
    
    // Track which modules load successfully
    window.BBB_MODULES_STATUS = {
      config: false,
      utils: false,
      auth: false,
      db: false,
      ui: false,
      startTime: Date.now()
    };
    
    // Function to update debug panel
    function updateDebugPanel() {
      const debugContent = document.getElementById('debug-content');
      if (!debugContent) return;
      
      const elapsed = Date.now() - window.BBB_MODULES_STATUS.startTime;
      let html = `<div>Loading time: ${elapsed}ms</div>`;
      
      Object.keys(window.BBB_MODULES_STATUS).forEach(key => {
        if (key === 'startTime') return;
        
        const status = window.BBB_MODULES_STATUS[key];
        const statusClass = status ? 'success' : 'error';
        const statusText = status ? '✓ Loaded' : '✗ Failed';
        
        html += `<div class="debug-status ${statusClass}">${key.toUpperCase()}: ${statusText}</div>`;
      });
      
      // Check if BBB_CONFIG is available and has members
      if (typeof BBB_CONFIG !== 'undefined') {
        const hasMembers = BBB_CONFIG.members && BBB_CONFIG.members.length > 0;
        const membersClass = hasMembers ? 'success' : 'warning';
        const membersText = hasMembers ? `✓ ${BBB_CONFIG.members.length} members` : '! No members array';
        html += `<div class="debug-status ${membersClass}">MEMBERS: ${membersText}</div>`;
        
        if (hasMembers) {
          html += `<div style="margin-top: 0.5rem; font-size: 0.8rem;">Members: ${BBB_CONFIG.members.slice(0, 5).join(', ')}${BBB_CONFIG.members.length > 5 ? '...' : ''}</div>`;
        }
      }
      
      debugContent.innerHTML = html;
    }
    
    // Function to check module status
    function checkModuleStatus() {
      console.log("Checking module status...");
      
      // Check each module
      window.BBB_MODULES_STATUS.config = typeof BBB_CONFIG !== 'undefined';
      window.BBB_MODULES_STATUS.utils = typeof BBB_UTILS !== 'undefined';
      window.BBB_MODULES_STATUS.auth = typeof BBB_AUTH !== 'undefined';
      window.BBB_MODULES_STATUS.db = typeof BBB_DB !== 'undefined';
      window.BBB_MODULES_STATUS.ui = typeof BBB_UI !== 'undefined';
      
      updateDebugPanel();
      
      // Also log to console
      console.log("Module Status:", window.BBB_MODULES_STATUS);
      
      if (typeof BBB_CONFIG !== 'undefined') {
        console.log("BBB_CONFIG.members:", BBB_CONFIG.members);
      }
    }
    
    // Function to test member loading
    function testMemberLoading() {
      console.log("Testing member loading...");
      const memberSelect = document.getElementById('member-select');
      
      if (!memberSelect) {
        console.error("Member select element not found!");
        return;
      }
      
      // Try to load members using different strategies
      let members = [];
      let source = 'none';
      
      // Strategy 1: BBB_CONFIG.members
      if (typeof BBB_CONFIG !== 'undefined' && BBB_CONFIG.members && BBB_CONFIG.members.length > 0) {
        members = BBB_CONFIG.members;
        source = 'BBB_CONFIG.members';
      }
      // Strategy 2: BBB_CONFIG.staticMembers  
      else if (typeof BBB_CONFIG !== 'undefined' && BBB_CONFIG.staticMembers && BBB_CONFIG.staticMembers.length > 0) {
        members = BBB_CONFIG.staticMembers;
        source = 'BBB_CONFIG.staticMembers';
      }
      
      console.log(`Found ${members.length} members from ${source}:`, members);
      
      if (members.length > 0) {
        populateMembers(members, source);
      } else {
        console.error("No members found in any source!");
        forceLoadMembers();
      }
    }
    
    // Function to force load members (hardcoded fallback)
    function forceLoadMembers() {
      console.log("Force loading hardcoded members...");
      const hardcodedMembers = [
        "Amrit", "Kam", "Vish", "Ravi", "Bal", "Vick", 
        "Michael", "Justy", "Phuperjee", "Indy", "Maj", "Sama"
      ];
      
      populateMembers(hardcodedMembers, 'hardcoded');
    }
    
    // Function to populate member dropdown
    function populateMembers(members, source) {
      const memberSelect = document.getElementById('member-select');
      if (!memberSelect) {
        console.error("Member select element not found!");
        return;
      }
      
      console.log(`Populating ${members.length} members from ${source}...`);
      
      // Clear existing options
      memberSelect.innerHTML = '<option value="">-- Select Member --</option>';
      
      // Add each member
      members.forEach((member, index) => {
        const option = document.createElement('option');
        option.value = typeof member === 'string' ? member.toLowerCase() : (member.id || member.username || member.display_name).toLowerCase();
        option.textContent = typeof member === 'string' ? member : (member.display_name || member.username || member.id);
        memberSelect.appendChild(option);
        
        console.log(`Added member ${index + 1}: ${option.textContent} (${option.value})`);
      });
      
      console.log(`Successfully populated ${members.length} members from ${source}`);
      
      // Show success message
      showMessage(`Successfully loaded ${members.length} members from ${source}`, 'success');
    }
    
    // Simple message function
    function showMessage(message, type) {
      const statusElement = document.getElementById('status-message');
      if (statusElement) {
        statusElement.textContent = message;
        statusElement.className = type;
        statusElement.style.display = 'block';
        
        setTimeout(() => {
          statusElement.style.display = 'none';
        }, 3000);
      }
      
      console.log(`[${type.toUpperCase()}] ${message}`);
    }
    
    // Initial status check when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM loaded, checking initial status...");
      setTimeout(checkModuleStatus, 100);
      setTimeout(testMemberLoading, 500);
    });
    
    // Update status every 2 seconds for the first 10 seconds
    let statusUpdateCount = 0;
    const statusInterval = setInterval(() => {
      checkModuleStatus();
      statusUpdateCount++;
      
      if (statusUpdateCount >= 5) {
        clearInterval(statusInterval);
        console.log("Status monitoring complete");
      }
    }, 2000);
  </script>

  <!-- ATTEMPT TO LOAD EXTERNAL MODULES -->
  <script>
    // Function to handle script loading success
    function onModuleLoad(moduleName) {
      console.log(`✓ ${moduleName} loaded successfully`);
      window.BBB_MODULES_STATUS[moduleName.toLowerCase()] = true;
      updateDebugPanel();
    }
    
    // Function to handle script loading failure
    function onModuleError(moduleName, error) {
      console.error(`✗ ${moduleName} failed to load:`, error);
      window.BBB_MODULES_STATUS[moduleName.toLowerCase()] = false;
      updateDebugPanel();
    }
  </script>
  
  <!-- Try to load your external modules -->
  <script src="js/config.js" onload="onModuleLoad('config')" onerror="onModuleError('config', 'File not found or syntax error')"></script>
  <script src="js/utils.js" onload="onModuleLoad('utils')" onerror="onModuleError('utils', 'File not found or syntax error')"></script>
  <script src="js/auth.js" onload="onModuleLoad('auth')" onerror="onModuleError('auth', 'File not found or syntax error')"></script>
  <script src="js/db.js" onload="onModuleLoad('db')" onerror="onModuleError('db', 'File not found or syntax error')"></script>
  <script src="js/ui.js" onload="onModuleLoad('ui')" onerror="onModuleError('ui', 'File not found or syntax error')"></script>

  <!-- Try member loading after a delay to let modules load -->
  <script>
    setTimeout(() => {
      console.log("Final attempt to load members after module loading...");
      testMemberLoading();
    }, 1000);
  </script>
</body>
</html>
